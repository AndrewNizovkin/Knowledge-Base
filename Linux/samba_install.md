# Установка samba

`sudo apt install samba -y`

Демон или сервис Samba называется smbd. Под таким именем и будем к нему обращаться.

Добавим сервис smbd в автозапуск:

`sudo systemctl enable smbd`

Запустим:

`sudo systemctl start smbd`

Проверим текущий статус:

`sudo systemctl stop smbd`

Перезапуск демона:

`sudo systemctl restart smbd`

Убрать из автозапуска:

`sudo systemctl disable smbd`

Перечитать конфигурацию:

`sudo systemctl reload smbd`

---

Если в настраиваемой системе включен брандмауэр ufw, необходимо добавить разрешающее правило для Samba:

```bash
sudo ufw allow Samba
```

или:

```bash
sudo ufw allow 445
```

```bash
sudo ufw allow 137
```

```bash
sudo ufw allow 138
```

```bash
sudo ufw allow 139
```

В каждом правиле указан порт из диапазона, в котором работает Samba.

---

## Настройка Samba

Конфигурационный файл Samba расположен по следующему пути:

```
/etc/samba/smb.conf
```

Лучше скопировать файл конфигурации по умолчанию, чтобы всегда 
оставлять себе возможность откатиться до дефолтных настроек Samba на 
Ubuntu.

Копируем командой:

```bash
sudo cp /etc/samba/smb.conf /etc/samba/res_smb.conf

```

Если нужно, далее оставим в файле конфигурации только те строки, которые используются в работе и не являются комментарием.

```bash
grep -v '^ *#\|^ *$' /etc/samba/smb.conf | sudo tee /etc/samba/smb.conf

```

На выходе получаем файл конфигурации без комментариев и неиспользуемых директив. Вот так он выглядит:

После сохранения конфигурации рекомендуется проверить ее работоспособность с помощью команды:

```bash
testparm
```

---

### Настройка анонимного доступа к директории

Для множества задач самым оптимальным и простым решением является 
настройка анонимного доступа к ресурсу. Это значит, что клиент имеет 
возможность обратиться к ресурсу на сервере без авторизации. Например, 
можно создать директорию с общим доступом, в которой хранится 
информация, которой не требуется безопасность.

Важно: данный способ используется очень редко. Это крайне небезопасно
 оставлять ресурс в таком состоянии. Обычно это делается для маленькой 
soho-сети в самых крайних случаях.

Создадим директорию, к которой будет предоставлен доступ:

```bash
sudo mkdir /var/anonimus_share

```

И добавим директории полные права для всех:

```bash
sudo chmod 775 /var/anonimus_share

```

Директория var использована как пример, в реальных задачах может быть
 предоставлен доступ к папке с логами, чтобы их изучить без подключения 
к серверу, или создание папки с общим доступом для обмена файлами. Такие
 права также назначены в ознакомительных целях.

Следующим шагом будут внесены изменения в директивы конфигурационного файла, в данной инструкции для этих целей использован текстовый редактор nano.

```bash
sudo nano /etc/samba/smb.conf
```

Добавим в файл следующий директивы:

```bash
[anonimus_share]
    comment = Directory anonimus
    path = /var/anonimus_share
    public = yes
    writable = yes
    read only = no
    guest ok = yes
    create mask = 0775
    directory mask = 0775
    force create mode = 0775
    force directory mode = 0775

```

Рассмотрим более подробно:

***[anonimus_share]*** 一 имя ресурса, отображаемое клиенту при подключении*;*

***comment = Directory anonimus*** 一 **комментарий;**

***path = /var/anonimus_share*** 一 директория, к которой предоставляем доступ*;*

***public = yes*** 一 доступ на чтение всем авторизованным пользователям, также гостевым;**

***writable = yes*** 一 право записи в сетевой ресурс;

***read only = no*** 一 право на чтение, при значении директивы *no* 一 **все пользователи получают право на создание директорий и файлов*;*

***guest ok = yes*** 一 доступ гостевой учетной записи*;*

- ***create mask = 0775**;*
- ***directory mask = 0775**;*
- ***force create mode = 0775**;*
- ***force directory mode = 0775**.*

Эти директивы задают права доступа, назначаемые при создании новой директории или файла.

После внесения изменений перезапускаем демона Samba:

```bash
sudo systemctl restart smbd

```

Чтобы открыть связанную папку (shared) нужно набрать в адресной строке проводника 

`\\192.168.0.14`