# Работа с Cisco Packet Tracer

## CLI - Command Line Interface

`Ctr+C` 

прерывание операции в командной строке

`Ctr+Shift+6` 

выход из зависшей команды

`?` 

список команд текущего режима

`enable` 

переход в расширенный режим 

`show running-config` 

просмотр конфигурации, можно show run

`configure terminal` 

управлять конфигурацией. Чтобы управлять конфигурацией какого-нибудь интерфейса, нужно ввести его в командной строке или скопипастить из выведенного show run списка.

`shutdown` 

выключить интерфейс

`no shutdown` 

отменить команду (no shutdown)

Чтобы просмотреть конфигурацию (show run), нужно выйти из  режима конфигурации или:

`do show run`  

просмотр конфигурации из режима конфигурации интерфейса

`ex` 

выход (из интерфейса)

`show mac-address-table` 

показывает таблицу мак адресов на свиче

`arp -a` - 

просмотр таблицы ARP (на PC)

`show ip route`  

просмотр таблицы маршрутизации но роутере в режиме enable. Показывает какие сети на каких интерфейсах в каких режимах

Все изменения, внесённые командами cli, будут потеряны при отключении роутера. Для сохранения изменений, нужно из записать:

`write memory (wr)` - запись в энергонезависимую память

`tracert 192.168.0.3` - утилита, позволяющая протестировать сеть. Посылает Hello пакеты с TTL, каждый раз увеличивающимся на единицу и умирающем на очередном узле (интерфейсе) сети на пути к 192.168.0.3

`ip route 10.0.0.0 255.255.255.0 1.1.1.1`

настройка статического маршрута, где

- `10.0.0.0 255.255.255.0` - IP адрес сети назначения, а

- `1.1.1.1` - некст-хоп, куда надо слать пакет в сеть 10.0.0.0 255.255.255.0

## `Настройка ospf процесса на роутере`

`router ospf 1` - запускает (заходим в)ospf процесс на роутере, может быть не один. Важно следить за тем, чтобы он был один. После этого работаем с этим процессом:

`router id 5.5.5.5` - здесь 5.5.5.5 не ip адрес, а id в формате ip

Добавляем все connected сети командой:

`network 192.168.0.0 0.0.0.255 area 0` - здесь `0.0.0.255` - Wildcard (только у Cisco), 

**Wildcard** - инвертированная маска сети

`do sh ip ospf neighbor` - показывает соседей.

`do sh ip route ospf` - показывает маршруты

### Настройка VLAN на свитче

`interface range <FastEthernet 0/1 - FastEthernet 1/1>`

Устанавливает диапазон интерфейсов. Либо через дефис, либо через запятую.

`switchport mode <ACCESS или TRUNK>`

Устанавливает один из режимов портов

`switchport access vlan 10`

задаёт номер VLAN

`show (do show) vlan`

показывает список сетей VLAN

`vlan 10`

переход в режим конфигурации сети vlan 10 (из режима conf t)

В этом режиме изменить имя сети:

`name ADMINS`

Один из интерфейсов настраивается в режиме TRUNK и для него перечисляются VLAN в которых он будет лежать:

`switchport trunk allowed vlan 10,20`

`switchport trunk allowed vlan add 30`

Добавляет VLANы

### Настройка VLAN на роутере

`interface Gigabit 0/1.10`

Создаёт подинтерфейс, где 10 указывают (обычно) номер VLAN

`encapsulation dot1Q 10`

прибивает (``*) vlan к интерфейсу, после чего прописываем IP

`ip address 1.1.1.1`

## Настройка Static NAT 1 : 1

Настройки делаются в режиме conf t

Определяем принадлежность интерфейса к инсайд или аутсайд стороне

`ip nat inside` для интерфейса, лежащего во внутренней сети

`ip nat outside` для интерфейса, лежащего во внешней сети

Выходим из интерфейса в режим `global config` и, в случае статики:

```bash
# 10.0.0.100 - внутр.сеть 7.7.7.1 - внешняя сеть 
ip nat inside source static 10.0.0.100 7.7.7.1 

```

Выходим из режима conf t  и смотрим текущие трансляции:

`show ip nat transtations`

## Настройка PAT (перегруженный NAT)

Настройки делаются в режиме conf t

Определяем принадлежность интерфейса к инсайд или аутсайд стороне

`ip nat inside` для интерфейса, лежащего во внутренней сети

`ip nat outside` для интерфейса, лежащего во внешней сети

Прежде чем настраивать роутер дальше (реж gl_conf), нужно создать access-list, командой:

`ip access-list standart NET_10`

где NET_10 - имя access-lista

Падаем в реж конф листа

`permit 10.10.10.0 0.0.0.255`

где 0.0.0.255  - wild

Выходим в gl_conf и продолжаем уст правила:

`ip nat inside source list NET_10 interface gigabitEthernet 0/0/0 overload`

Настройка закончена. ip nat translation пока пуста. После выхода в сеть абонентов сети 10.10.10.0/24, в таблице появятся записи типа ip:port

## Настройка Port Forwarding

Задача: разделить один ip для двух серверов с разными портами (80 и 443). 

Настройки делаются в режиме `conf t`

Определяем принадлежность интерфейса к инсайд или аутсайд стороне

`ip nat inside` для интерфейса, лежащего во внутренней сети

`ip nat outside` для интерфейса, лежащего во внешней сети

В режиме `global_config` :

`ip nat inside source static tcp 10.0.0.100 80 6.6.6.1 80`

где `10.0.0.100 80` - ip port внутренний
`6.6.6.1 80` - ip port внешний


Те же операции делаются для второго внутреннего ip


`ip nat inside source static tcp 10.0.0.101 443 6.6.6.1 443`


## Настройка GRE

Заходим на роутер в реж conf t и создаём туннельный интерфейс с произвольным номером


`interface tunnel 777`


Присваиваем ему  ip из промежуточной сети


`ip address 172.16.0.1 255.255.255.0`


Указываем публичный source интерфейс через который мы будем выпускать пакет с доп. заголовком

`tunnel source gigabitEthernet 0/0/1`

Указываем ip dist сети с которой связываем сеть

`tunnel destination 4.4.4.2`

Из gl_conf прописываем маршрут в dist сеть, указывая ip роутера из промежуточной сети в качестве Next hop

`ip route 192.168.0.0 255.255.255.0 172.16.0.2`

На втором роутере (в котором dist сеть) делаем встречные настройки

### Настройка DNS

Настройка на сервере DNS:

На вкладке Services → DNS  прописываем доменное имя и ip

Настройка на пользовательской машине:

На вкладке Config прописываем ip адрес DNS сервера