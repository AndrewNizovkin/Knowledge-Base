# Браузерные события и их обработка

Событие – это сигнал от браузера о том, что что-то произошло. Все DOM-узлы подают такие сигналы (хотя события бывают и не только в DOM).

## Список часто используемых DOM-событий

События мыши:

- `click` – происходит, когда кликнули на элемент левой кнопкой мыши (на устройствах с сенсорными экранами оно происходит при касании).

- `contextmenu` – происходит, когда кликнули на элемент правой кнопкой мыши.

- `mouseover / mouseout` – когда мышь наводится на / покидает элемент.

- `mousedown / mouseup` – когда нажали / отжали кнопку мыши на элементе.

- `mousemove` – при движении мыши.

События на элементах управления:

- `submit` – пользователь отправил форму <form>.

- `focus` – пользователь фокусируется на элементе, например нажимает на `<input>`.

Клавиатурные события:

- `keydown` и `keyup` – когда пользователь нажимает / отпускает клавишу.

События документа:

- `DOMContentLoaded` – когда HTML загружен и обработан, DOM документа полностью построен и доступен.

CSS events:

- `transitionend` – когда CSS-анимация завершена.

## Обработчики событий

Событию можно назначить обработчик, то есть функцию, которая сработает, как только событие произошло.

Обработчик может быть назначен прямо в разметке, в атрибуте, который называется `on<событие>`.

```html
<input value="Нажми меня" onclick="alert('Клик!')" type="button">
```

Атрибут HTML-тега – не самое удобное место для написания большого количества кода, поэтому лучше создать отдельную JavaScript-функцию и вызвать её там.

```html
<script>
  function countRabbits() {
    for(let i=1; i<=3; i++) {
      alert("Кролик номер " + i);
    }
  }
</script>

<input type="button" onclick="countRabbits()" value="Считать кроликов!">
```

Можно назначать обработчик, используя свойство DOM-элемента `on<событие>`.

```html
<input id="elem" type="button" value="Нажми меня!">
<script>
  elem.onclick = function() {
    alert('Спасибо');
  };
</script>
```

Обработчиком можно назначить и уже существующую функцию:

```js
function sayThanks() {
  alert('Спасибо!');
}

elem.onclick = sayThanks;
```

> Обработчик всегда хранится в свойстве DOM-объекта, а атрибут – лишь один из способов его инициализации.

Внутри обработчика события `this` ссылается на текущий элемент, то есть на тот, на котором, как говорят, «висит» (т.е. назначен) обработчик.

```html
<input type="button" id="button" onclick="sayThanks()">
```

> Функция должна быть присвоена как sayThanks, а не sayThanks().

```js
// правильно
button.onclick = sayThanks;

// неправильно
button.onclick = sayThanks();
```

…А вот в разметке, в отличие от свойства, скобки нужны:

```html
<input type="button" id="button" onclick="sayThanks()">
```

### addEventListener

При помощи специальных методов `addEventListener` и `removeEventListener` можно добавить несколько обработчиков для одного события.

```js
lement.addEventListener(event, handler, [options]);
```

`event`
Имя события, например "click".

`handler`
Ссылка на функцию-обработчик.

`options`
Дополнительный объект со свойствами:
 - once`: если true, тогда обработчик будет автоматически удалён после выполнения.

 - capture: фаза, на которой должен сработать обработчик, подробнее об этом будет рассказано в главе Всплытие и погружение. Так исторически сложилось, что options может быть false/true, это то же самое, что {capture: false/true}.

 - passive: если true, то указывает, что обработчик никогда не вызовет preventDefault(), подробнее об этом будет рассказано в главе Действия браузера по умолчанию.

Для удаления обработчика следует использовать `removeEventListener`:

```js
element.removeEventListener(event, handler, [options]);
```

> Обработчики некоторых событий можно назначать только через addEventListener

Например, таково событие DOMContentLoaded, которое срабатывает, когда завершена загрузка и построение DOM документа.

```js
document.onDOMContentLoaded = function() {
  alert("DOM построен"); // не будет работать
};

document.addEventListener("DOMContentLoaded", function() {
  alert("DOM построен"); // а вот так сработает
});
```

### Объект события

Чтобы хорошо обработать событие, могут понадобиться детали того, что произошло. Не просто «клик» или «нажатие клавиши», а также – какие координаты указателя мыши, какая клавиша нажата и так далее.

```js
<input type="button" value="Нажми меня" id="elem">

<script>
  elem.onclick = function(event) {
    // вывести тип события, элемент и координаты клика
    alert(event.type + " на " + event.currentTarget);
    alert("Координаты: " + event.clientX + ":" + event.clientY);
  };
</script>
```

